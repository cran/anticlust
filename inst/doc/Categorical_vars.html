<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Martin Papenberg" />


<title>Using categorical variables with anticlustering</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Using categorical variables with anticlustering</h1>
<h4 class="author">Martin Papenberg</h4>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(anticlust)</a></code></pre></div>
<p>In this vignette I explore two ways to incorporate categorical variables with anticlustering. The main function of <code>anticlust</code> is <code>anticlustering()</code>, and it has an argument <code>categories</code>. It can be used easily enough: We just pass the numeric variables as first argument (<code>x</code>) and our categorical variable(s) to <code>categories</code>. I will use the penguin data set from the <code>palmerpenguins</code> package to illustrate the usage:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(palmerpenguins)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="co"># First exclude cases with missing values</span></a>
<a class="sourceLine" id="cb2-3" title="3">df &lt;-<span class="st"> </span><span class="kw">na.omit</span>(penguins)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">head</span>(df)</a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt; # A tibble: 6 × 8</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt;   species island    bill_length_mm bill_depth_mm flipper_length_mm body_mass_g</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;             &lt;int&gt;       &lt;int&gt;</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt; 1 Adelie  Torgersen           39.1          18.7               181        3750</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; 2 Adelie  Torgersen           39.5          17.4               186        3800</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt; 3 Adelie  Torgersen           40.3          18                 195        3250</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt; 4 Adelie  Torgersen           36.7          19.3               193        3450</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">#&gt; 5 Adelie  Torgersen           39.3          20.6               190        3650</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">#&gt; 6 Adelie  Torgersen           38.9          17.8               181        3625</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">#&gt; # ℹ 2 more variables: sex &lt;fct&gt;, year &lt;int&gt;</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="kw">nrow</span>(df)</a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">#&gt; [1] 333</span></a></code></pre></div>
<p>In the data set, each row represents a penguin, and the data set has four numeric variables (bill_length_mm, bill_depth_mm, flipper_length_mm, body_mass_g) and several categorical variables (species, island, sex) as descriptions of the penguins.</p>
<p>Let’s call <code>anticlustering()</code> to divide the 333 penguins into 3 groups. We use the four the numeric variables as first argument (i.e., the anticlustering objective is computed on the basis of the numeric variables), and the penguins’ sex as categorical variable:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">numeric_vars &lt;-<span class="st"> </span>df[, <span class="kw">c</span>(<span class="st">&quot;bill_length_mm&quot;</span>, <span class="st">&quot;bill_depth_mm&quot;</span>, <span class="st">&quot;flipper_length_mm&quot;</span>, <span class="st">&quot;body_mass_g&quot;</span>)]</a>
<a class="sourceLine" id="cb3-2" title="2">groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb3-3" title="3">  numeric_vars, </a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="dt">K =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">categories =</span> df<span class="op">$</span>sex</a>
<a class="sourceLine" id="cb3-6" title="6">)</a></code></pre></div>
<p>Let’s check out how well our categorical variables are balanced:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1"><span class="kw">table</span>(groups, df<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb4-2" title="2"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb4-4" title="4"><span class="co">#&gt;      1     55   56</span></a>
<a class="sourceLine" id="cb4-5" title="5"><span class="co">#&gt;      2     55   56</span></a>
<a class="sourceLine" id="cb4-6" title="6"><span class="co">#&gt;      3     55   56</span></a></code></pre></div>
<p>A perfect split! Similarly, we could use the species as categorical variable:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb5-2" title="2">  numeric_vars, </a>
<a class="sourceLine" id="cb5-3" title="3">  <span class="dt">K =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb5-4" title="4">  <span class="dt">categories =</span> df<span class="op">$</span>species</a>
<a class="sourceLine" id="cb5-5" title="5">)</a>
<a class="sourceLine" id="cb5-6" title="6"></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="kw">table</span>(groups, df<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">#&gt;      1     49        22     40</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="co">#&gt;      2     49        23     39</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="co">#&gt;      3     48        23     40</span></a></code></pre></div>
<p>As good as it could be! Now, let’s use both categorical variables at the same time:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  numeric_vars, </a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">K =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">categories =</span> df[, <span class="kw">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;sex&quot;</span>)]</a>
<a class="sourceLine" id="cb6-5" title="5">)</a>
<a class="sourceLine" id="cb6-6" title="6"></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="kw">table</span>(groups, df<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt;      1     54   57</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt;      2     56   55</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt;      3     55   56</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="kw">table</span>(groups, df<span class="op">$</span>species) </a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb6-15" title="15"><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></a>
<a class="sourceLine" id="cb6-16" title="16"><span class="co">#&gt;      1     49        22     40</span></a>
<a class="sourceLine" id="cb6-17" title="17"><span class="co">#&gt;      2     49        23     39</span></a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co">#&gt;      3     48        23     40</span></a></code></pre></div>
<p>The results for the sex variable are worse than previously when we only considered one variable at a time. This is because when using multiple variables with the <code>categories</code> argument, all columns are “merged” into a single column, and each combination of sex / species is treated as a separate category. Some information on the original variables is lost, and the results may become less optimal—while being still pretty okay here. Alas, using only the <code>categories</code> argument, we cannot improve this balancing even if a better split with regard to both categorical variables would be possible.</p>
<div id="k-means-anticlustering" class="section level2">
<h2>K-Means Anticlustering</h2>
<p>K-means anticlustering offers a second possibility to distribute categorical variables evenly between groups. This approach can lead to better results when multiple categorical variables are available, and / or if the group sizes are unequal. To use this approach, we first generate a matrix of the categorical variables in binary representation using the <code>anticlust</code> convenience function <code>categories_to_binary()</code>.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Because k-means anticlustering optimizes similarity with regard to means, k-means anticlustering applied to this binary matrix will even out the proportion of each category in each group (this is because the mean of a binary variable is the proportion of <code>1</code>s in that variable).</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">binary_categories &lt;-<span class="st"> </span><span class="kw">categories_to_binary</span>(df[, <span class="kw">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;sex&quot;</span>)])</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co"># see ?categories_to_binary</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">head</span>(binary_categories)</a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt;   speciesChinstrap speciesGentoo sexmale</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; 1                0             0       1</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; 2                0             0       0</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; 3                0             0       0</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; 4                0             0       0</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; 5                0             0       1</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; 6                0             0       0</span></a></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  binary_categories,</a>
<a class="sourceLine" id="cb8-3" title="3">  <span class="dt">K =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb8-4" title="4">  <span class="dt">method =</span> <span class="st">&quot;local-maximum&quot;</span>, </a>
<a class="sourceLine" id="cb8-5" title="5">  <span class="dt">objective =</span> <span class="st">&quot;variance&quot;</span>,</a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="dt">repetitions =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb8-7" title="7">  <span class="dt">standardize =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb8-8" title="8">)</a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">table</span>(groups, df<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb8-10" title="10"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb8-11" title="11"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb8-12" title="12"><span class="co">#&gt;      1     55   56</span></a>
<a class="sourceLine" id="cb8-13" title="13"><span class="co">#&gt;      2     55   56</span></a>
<a class="sourceLine" id="cb8-14" title="14"><span class="co">#&gt;      3     55   56</span></a>
<a class="sourceLine" id="cb8-15" title="15"><span class="kw">table</span>(groups, df<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb8-16" title="16"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb8-17" title="17"><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></a>
<a class="sourceLine" id="cb8-18" title="18"><span class="co">#&gt;      1     48        23     40</span></a>
<a class="sourceLine" id="cb8-19" title="19"><span class="co">#&gt;      2     49        23     39</span></a>
<a class="sourceLine" id="cb8-20" title="20"><span class="co">#&gt;      3     49        22     40</span></a></code></pre></div>
<p>The results are quite convincing. In particular, the penguins’ sex is better balanced than previously when we used the argument <code>categories</code>. If we have multiple categorical variables and / or unequal-sized groups, it may be useful to try out the k-means optimization version of including categorical variables, instead of (only) using the <code>categories</code> argument. If we also wish to ensure that the categorical variables <em>in their combination</em> are balanced between groups (i.e., the proportion of the penguins’ sex is roughly the same for each species in each group), we could set the optional argument <code>use_combinations</code> of <code>categories_to_binary()</code> to <code>TRUE</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">binary_categories &lt;-<span class="st"> </span><span class="kw">categories_to_binary</span>(df[, <span class="kw">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;sex&quot;</span>)], <span class="dt">use_combinations =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb9-2" title="2">groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb9-3" title="3">  binary_categories,</a>
<a class="sourceLine" id="cb9-4" title="4">  <span class="dt">K =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb9-5" title="5">  <span class="dt">method =</span> <span class="st">&quot;local-maximum&quot;</span>, </a>
<a class="sourceLine" id="cb9-6" title="6">  <span class="dt">objective =</span> <span class="st">&quot;variance&quot;</span>,</a>
<a class="sourceLine" id="cb9-7" title="7">  <span class="dt">repetitions =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb9-8" title="8">  <span class="dt">standardize =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb9-9" title="9">)</a>
<a class="sourceLine" id="cb9-10" title="10"><span class="kw">table</span>(groups, df<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb9-11" title="11"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb9-12" title="12"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">#&gt;      1     55   56</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">#&gt;      2     55   56</span></a>
<a class="sourceLine" id="cb9-15" title="15"><span class="co">#&gt;      3     55   56</span></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="kw">table</span>(groups, df<span class="op">$</span>species) </a>
<a class="sourceLine" id="cb9-17" title="17"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb9-18" title="18"><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></a>
<a class="sourceLine" id="cb9-19" title="19"><span class="co">#&gt;      1     48        23     40</span></a>
<a class="sourceLine" id="cb9-20" title="20"><span class="co">#&gt;      2     49        22     40</span></a>
<a class="sourceLine" id="cb9-21" title="21"><span class="co">#&gt;      3     49        23     39</span></a>
<a class="sourceLine" id="cb9-22" title="22"><span class="kw">table</span>(groups, df<span class="op">$</span>sex, df<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb9-23" title="23"><span class="co">#&gt; , ,  = Adelie</span></a>
<a class="sourceLine" id="cb9-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-25" title="25"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb9-26" title="26"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb9-27" title="27"><span class="co">#&gt;      1     23   25</span></a>
<a class="sourceLine" id="cb9-28" title="28"><span class="co">#&gt;      2     25   24</span></a>
<a class="sourceLine" id="cb9-29" title="29"><span class="co">#&gt;      3     25   24</span></a>
<a class="sourceLine" id="cb9-30" title="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-31" title="31"><span class="co">#&gt; , ,  = Chinstrap</span></a>
<a class="sourceLine" id="cb9-32" title="32"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-33" title="33"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb9-34" title="34"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb9-35" title="35"><span class="co">#&gt;      1     12   11</span></a>
<a class="sourceLine" id="cb9-36" title="36"><span class="co">#&gt;      2     10   12</span></a>
<a class="sourceLine" id="cb9-37" title="37"><span class="co">#&gt;      3     12   11</span></a>
<a class="sourceLine" id="cb9-38" title="38"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-39" title="39"><span class="co">#&gt; , ,  = Gentoo</span></a>
<a class="sourceLine" id="cb9-40" title="40"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb9-41" title="41"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb9-42" title="42"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb9-43" title="43"><span class="co">#&gt;      1     20   20</span></a>
<a class="sourceLine" id="cb9-44" title="44"><span class="co">#&gt;      2     20   20</span></a>
<a class="sourceLine" id="cb9-45" title="45"><span class="co">#&gt;      3     18   21</span></a></code></pre></div>
<p>Note that we only evenly distributed the categorical variable between groups and did not consider the numeric variables—which is however why we would usually call <code>anticlustering()</code>. Fortunately, also considering the numeric variables is possible, and can we accomplish that in two different ways:</p>
<ol style="list-style-type: lower-alpha">
<li>we first optimize similarity with regard to the categorical variable(s) via k-means anticlustering, and then insert the resulting group assignment as a “hard constraint” into <code>anticlustering()</code></li>
<li>we simultaneous optimize similarity with regard to numeric and categorical variables</li>
</ol>
<p>We discuss both approaches in the following.</p>
<div id="a.-sequential-optimization" class="section level3">
<h3>a. Sequential optimization</h3>
<p>We use the output vector <code>groups</code> of the previous call to <code>anticlustering()</code>—which convincingly balanced our categorical variables—as input to the <code>K</code> argument in an additional call to <code>anticlustering()</code>. The <code>groups</code> vector is used as the initial group assignment before the anticlustering optimization starts. In this group assignment, the categories are already well balanced. We additionally pass the two categorical variables to <code>categories</code>, thus ensuring that the balancing of the categorical variable is never changed throughout the optimization process:<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1">final_groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb10-2" title="2">  numeric_vars,</a>
<a class="sourceLine" id="cb10-3" title="3">  <span class="dt">K =</span> groups,</a>
<a class="sourceLine" id="cb10-4" title="4">  <span class="dt">standardize =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb10-5" title="5">  <span class="dt">method =</span> <span class="st">&quot;local-maximum&quot;</span>,</a>
<a class="sourceLine" id="cb10-6" title="6">  <span class="dt">categories =</span> df[, <span class="kw">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;sex&quot;</span>)]</a>
<a class="sourceLine" id="cb10-7" title="7">)</a>
<a class="sourceLine" id="cb10-8" title="8"></a>
<a class="sourceLine" id="cb10-9" title="9"><span class="kw">table</span>(groups, df<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb10-10" title="10"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb10-11" title="11"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb10-12" title="12"><span class="co">#&gt;      1     55   56</span></a>
<a class="sourceLine" id="cb10-13" title="13"><span class="co">#&gt;      2     55   56</span></a>
<a class="sourceLine" id="cb10-14" title="14"><span class="co">#&gt;      3     55   56</span></a>
<a class="sourceLine" id="cb10-15" title="15"><span class="kw">table</span>(groups, df<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb10-16" title="16"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb10-17" title="17"><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></a>
<a class="sourceLine" id="cb10-18" title="18"><span class="co">#&gt;      1     48        23     40</span></a>
<a class="sourceLine" id="cb10-19" title="19"><span class="co">#&gt;      2     49        22     40</span></a>
<a class="sourceLine" id="cb10-20" title="20"><span class="co">#&gt;      3     49        23     39</span></a>
<a class="sourceLine" id="cb10-21" title="21"><span class="kw">mean_sd_tab</span>(numeric_vars, final_groups)</a>
<a class="sourceLine" id="cb10-22" title="22"><span class="co">#&gt;   bill_length_mm bill_depth_mm  flipper_length_mm body_mass_g       </span></a>
<a class="sourceLine" id="cb10-23" title="23"><span class="co">#&gt; 1 &quot;44.00 (5.50)&quot; &quot;17.16 (1.98)&quot; &quot;201.00 (14.17)&quot;  &quot;4208.78 (809.97)&quot;</span></a>
<a class="sourceLine" id="cb10-24" title="24"><span class="co">#&gt; 2 &quot;44.00 (5.50)&quot; &quot;17.17 (2.00)&quot; &quot;200.93 (13.97)&quot;  &quot;4206.31 (798.76)&quot;</span></a>
<a class="sourceLine" id="cb10-25" title="25"><span class="co">#&gt; 3 &quot;43.98 (5.45)&quot; &quot;17.16 (1.95)&quot; &quot;200.97 (14.03)&quot;  &quot;4206.08 (814.14)&quot;</span></a></code></pre></div>
<p>The results are convincing, both with regard to the numeric variables and the categorical variables.</p>
</div>
<div id="b.-simultaneous-optimization" class="section level3">
<h3>b. Simultaneous optimization</h3>
<p>We can simultaneously consider the numeric and categorical variables in the optimization process. Note that this approach only works with the k-means and k-plus objectives, because only k-means adequately deals with the categorical variables (at least when using the approach described here). Using the simultaneous approach, we just pass all variables (representing binary categories and numeric variables) as a single matrix to the first argument of <code>anticlustering()</code>. Do not use the <code>categories</code> argument here!</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">final_groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb11-2" title="2">  <span class="kw">cbind</span>(numeric_vars, binary_categories),</a>
<a class="sourceLine" id="cb11-3" title="3">  <span class="dt">K =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb11-4" title="4">  <span class="dt">standardize =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb11-5" title="5">  <span class="dt">method =</span> <span class="st">&quot;local-maximum&quot;</span>, </a>
<a class="sourceLine" id="cb11-6" title="6">  <span class="dt">objective =</span> <span class="st">&quot;variance&quot;</span>,</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="dt">repetitions =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb11-8" title="8">)</a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10"><span class="kw">table</span>(groups, df<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb11-11" title="11"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb11-13" title="13"><span class="co">#&gt;      1     55   56</span></a>
<a class="sourceLine" id="cb11-14" title="14"><span class="co">#&gt;      2     55   56</span></a>
<a class="sourceLine" id="cb11-15" title="15"><span class="co">#&gt;      3     55   56</span></a>
<a class="sourceLine" id="cb11-16" title="16"><span class="kw">table</span>(groups, df<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb11-17" title="17"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></a>
<a class="sourceLine" id="cb11-19" title="19"><span class="co">#&gt;      1     48        23     40</span></a>
<a class="sourceLine" id="cb11-20" title="20"><span class="co">#&gt;      2     49        22     40</span></a>
<a class="sourceLine" id="cb11-21" title="21"><span class="co">#&gt;      3     49        23     39</span></a>
<a class="sourceLine" id="cb11-22" title="22"><span class="kw">mean_sd_tab</span>(numeric_vars, final_groups)</a>
<a class="sourceLine" id="cb11-23" title="23"><span class="co">#&gt;   bill_length_mm bill_depth_mm  flipper_length_mm body_mass_g       </span></a>
<a class="sourceLine" id="cb11-24" title="24"><span class="co">#&gt; 1 &quot;43.99 (5.29)&quot; &quot;17.16 (2.16)&quot; &quot;200.97 (13.20)&quot;  &quot;4207.21 (760.65)&quot;</span></a>
<a class="sourceLine" id="cb11-25" title="25"><span class="co">#&gt; 2 &quot;43.99 (5.77)&quot; &quot;17.16 (1.95)&quot; &quot;200.96 (15.01)&quot;  &quot;4206.98 (887.34)&quot;</span></a>
<a class="sourceLine" id="cb11-26" title="26"><span class="co">#&gt; 3 &quot;43.99 (5.39)&quot; &quot;17.17 (1.80)&quot; &quot;200.96 (13.91)&quot;  &quot;4206.98 (768.74)&quot;</span></a></code></pre></div>
<p>The following code extends the simultaneous optimization approach towards k-plus anticlustering, which ensures that standard deviations as well as means are similar between groups (and not only the means, which is achieved via standard k-means anticlustering):</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">final_groups &lt;-<span class="st"> </span><span class="kw">anticlustering</span>(</a>
<a class="sourceLine" id="cb12-2" title="2">  <span class="kw">cbind</span>(<span class="kw">kplus_moment_variables</span>(numeric_vars, <span class="dt">T =</span> <span class="dv">2</span>), binary_categories),</a>
<a class="sourceLine" id="cb12-3" title="3">  <span class="dt">K =</span> <span class="dv">3</span>,</a>
<a class="sourceLine" id="cb12-4" title="4">  <span class="dt">method =</span> <span class="st">&quot;local-maximum&quot;</span>, </a>
<a class="sourceLine" id="cb12-5" title="5">  <span class="dt">objective =</span> <span class="st">&quot;variance&quot;</span>, </a>
<a class="sourceLine" id="cb12-6" title="6">  <span class="dt">repetitions =</span> <span class="dv">10</span></a>
<a class="sourceLine" id="cb12-7" title="7">)</a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="kw">table</span>(groups, df<span class="op">$</span>sex)</a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; groups female male</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt;      1     55   56</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt;      2     55   56</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt;      3     55   56</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="kw">table</span>(groups, df<span class="op">$</span>species)</a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt;       </span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; groups Adelie Chinstrap Gentoo</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt;      1     48        23     40</span></a>
<a class="sourceLine" id="cb12-19" title="19"><span class="co">#&gt;      2     49        22     40</span></a>
<a class="sourceLine" id="cb12-20" title="20"><span class="co">#&gt;      3     49        23     39</span></a>
<a class="sourceLine" id="cb12-21" title="21"><span class="kw">mean_sd_tab</span>(numeric_vars, final_groups)</a>
<a class="sourceLine" id="cb12-22" title="22"><span class="co">#&gt;   bill_length_mm bill_depth_mm  flipper_length_mm body_mass_g       </span></a>
<a class="sourceLine" id="cb12-23" title="23"><span class="co">#&gt; 1 &quot;44.00 (5.49)&quot; &quot;17.16 (1.98)&quot; &quot;200.98 (14.05)&quot;  &quot;4205.41 (807.48)&quot;</span></a>
<a class="sourceLine" id="cb12-24" title="24"><span class="co">#&gt; 2 &quot;43.98 (5.48)&quot; &quot;17.16 (1.97)&quot; &quot;200.96 (14.06)&quot;  &quot;4207.21 (807.60)&quot;</span></a>
<a class="sourceLine" id="cb12-25" title="25"><span class="co">#&gt; 3 &quot;44.00 (5.48)&quot; &quot;17.17 (1.98)&quot; &quot;200.95 (14.06)&quot;  &quot;4208.56 (807.87)&quot;</span></a></code></pre></div>
<p>While we use <code>objective = &quot;variance&quot;</code>—indicating that the k-means objective is used—this code actually performs k-plus anticlustering because the first argument takes as input the augmented k-plus variable matrix<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a>. We see that the standard deviations are now also quite evenly matched between groups (which is unlike when using standard k-means anticlustering).</p>
<p>In the end: You should try out the different approaches for dealing with categorical variables and see which one works best for you!</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>Internally, <code>categories_to_binary()</code> is just a thin wrapper around the base <code>R</code> function <code>model.matrix()</code>.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>Only elements that have the same value in <code>categories</code> are exchanged between clusters throughout the optimization algorithm, so the initial balancing of the categories is never changed when the algorithm runs.<a href="#fnref2" class="footnote-back">↩</a></p></li>
<li id="fn3"><p>This is how k-plus anticlustering actually works: It reuses the k-means criterion but uses additional “k-plus” variables as input. More information on the k-plus approach is given in the documentation: <code>?kplus_moment_variables</code> and <code>?kplus_anticlustering</code>.<a href="#fnref3" class="footnote-back">↩</a></p></li>
</ol>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
